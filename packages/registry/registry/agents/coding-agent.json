{
	"name": "coding-agent",
	"type": "registry:agent",
	"title": "Coding Agent",
	"description": "Coding Agent - an AI agent",
	"dependencies": ["ai"],
	"registryDependencies": [
		"agents:lib/context",
		"agents:lib/environment",
		"agents:lib/permissions",
		"prompts:coding-agent",
		"tools:bash",
		"tools:edit",
		"tools:glob",
		"tools:grep",
		"tools:list",
		"tools:read",
		"tools:write"
	],
	"files": [
		{
			"path": "agents/coding-agent.ts",
			"type": "registry:agent",
			"content": "import { Experimental_Agent as Agent, type LanguageModel } from \"ai\"\nimport { summarizeMessages } from \"@/agents/lib/context\"\nimport {\n\ttype EnvironmentContext,\n\ttype EnvironmentOptions,\n\tgetEnvironmentContext,\n} from \"@/agents/lib/environment\"\nimport {\n\tDANGEROUS_COMMANDS,\n\tFILE_READ_COMMANDS,\n\tGIT_READ_COMMANDS,\n\ttype Permission,\n\tSEARCH_COMMANDS,\n\tTEXT_PROCESSING_COMMANDS,\n} from \"@/agents/lib/permissions\"\nimport { getSystemPrompt } from \"@/prompts/coding-agent\"\nimport { createBashTool } from \"@/tools/bash\"\nimport { createEditTool } from \"@/tools/edit\"\nimport { globTool } from \"@/tools/glob\"\nimport { grepTool } from \"@/tools/grep\"\nimport { listTool } from \"@/tools/list\"\nimport { readTool } from \"@/tools/read\"\nimport { createWriteTool } from \"@/tools/write\"\n\nconst BASH_PERMISSIONS: Record<string, Permission> = {\n\t...FILE_READ_COMMANDS,\n\t...SEARCH_COMMANDS,\n\t...TEXT_PROCESSING_COMMANDS,\n\t...GIT_READ_COMMANDS,\n\t...DANGEROUS_COMMANDS,\n\t\"*\": \"ask\",\n}\n\nexport interface AgentSettings {\n\tmodel: LanguageModel\n\tcwd?: string\n\tenvironment?: EnvironmentOptions\n}\n\nexport async function createAgent({ model, cwd, environment }: AgentSettings) {\n\tconst env = await getEnvironmentContext({ cwd, ...environment })\n\tconst instructions = getSystemPrompt(env)\n\n\tconst tools = {\n\t\tread: readTool,\n\t\twrite: createWriteTool(),\n\t\tedit: createEditTool(),\n\t\tbash: createBashTool(BASH_PERMISSIONS),\n\t\tlist: listTool,\n\t\tgrep: grepTool,\n\t\tglob: globTool,\n\t}\n\n\tconst agent = new Agent({\n\t\tmodel,\n\t\tinstructions,\n\t\ttools,\n\t\tasync prepareStep({ steps, messages }) {\n\t\t\tconst threshold = 200_000\n\t\t\tconst lastStep = steps.at(-1)\n\t\t\tconst inputTokens = lastStep?.usage?.inputTokens\n\n\t\t\tif (!inputTokens || inputTokens < threshold) {\n\t\t\t\treturn {}\n\t\t\t}\n\n\t\t\tconst summarized = await summarizeMessages(messages, model, {\n\t\t\t\tthreshold,\n\t\t\t\tkeepRecent: 8,\n\t\t\t\tprotectTokens: 40_000,\n\t\t\t})\n\n\t\t\treturn summarized ? { messages: summarized } : {}\n\t\t},\n\t\tproviderOptions: {\n\t\t\topenai: {\n\t\t\t\treasoningEffort: \"medium\",\n\t\t\t\treasoningSummary: \"detailed\",\n\t\t\t},\n\t\t},\n\t\tstopWhen: ({ steps }) => {\n\t\t\tif (steps.length === 0) return false\n\n\t\t\tconst lastStep = steps[steps.length - 1]\n\t\t\tif (!lastStep) return false\n\n\t\t\t// Continue if last step had tool calls (agent is still working)\n\t\t\tif (lastStep.toolCalls && lastStep.toolCalls.length > 0) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\t// Default: Agent generated text, so stop.\n\t\t\treturn true\n\t\t},\n\t})\n\n\treturn agent\n}\n"
		}
	]
}
